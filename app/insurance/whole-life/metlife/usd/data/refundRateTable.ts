// 메트라이프 달러종신보험 환급률 조견표 (10년 시점 기준)
// 단위: % (예: 124.9 = 124.9%)

export type Gender = 'M' | 'F';
export type PaymentPeriod = '5년납' | '7년납' | '10년납';

interface RefundRateData {
  [age: number]: {
    M: number;  // 남자 환급률
    F: number;  // 여자 환급률
  };
}

interface RefundRateTable {
  '5년납': RefundRateData;
  '7년납': RefundRateData;
  '10년납': RefundRateData;
}

export const REFUND_RATE_TABLE: RefundRateTable = {
  '5년납': {
    15: { M: 124.9, F: 124.8 },
    16: { M: 124.9, F: 124.9 },
    17: { M: 124.9, F: 124.9 },
    18: { M: 124.9, F: 124.9 },
    19: { M: 124.8, F: 124.9 },
    20: { M: 124.9, F: 124.9 },
    21: { M: 124.8, F: 124.9 },
    22: { M: 124.9, F: 124.9 },
    23: { M: 124.9, F: 124.9 },
    24: { M: 124.9, F: 124.9 },
    25: { M: 124.9, F: 124.9 },
    26: { M: 124.9, F: 124.9 },
    27: { M: 124.9, F: 125.0 },
    28: { M: 124.9, F: 125.0 },
    29: { M: 124.9, F: 125.0 },
    30: { M: 124.9, F: 124.9 },
    31: { M: 124.9, F: 125.0 },
    32: { M: 124.9, F: 125.0 },
    33: { M: 125.0, F: 125.0 },
    34: { M: 124.9, F: 125.0 },
    35: { M: 124.9, F: 125.0 },
    36: { M: 124.9, F: 125.0 },
    37: { M: 124.9, F: 125.0 },
    38: { M: 124.9, F: 125.0 },
    39: { M: 124.9, F: 125.0 },
    40: { M: 124.9, F: 125.0 },
    41: { M: 124.9, F: 125.0 },
    42: { M: 124.8, F: 125.0 },
    43: { M: 124.8, F: 125.0 },
    44: { M: 124.8, F: 124.9 },
    45: { M: 124.8, F: 124.9 },
    46: { M: 124.7, F: 124.9 },
    47: { M: 124.7, F: 124.9 },
    48: { M: 124.6, F: 124.9 },
    49: { M: 124.6, F: 124.9 },
    50: { M: 124.5, F: 124.9 },
    51: { M: 124.5, F: 124.8 },
    52: { M: 124.4, F: 124.8 },
    53: { M: 124.4, F: 124.8 },
    54: { M: 124.3, F: 124.8 },
    55: { M: 124.2, F: 124.8 },
    56: { M: 124.1, F: 124.7 },
    57: { M: 124.0, F: 124.7 },
    58: { M: 123.9, F: 124.6 },
    59: { M: 123.7, F: 124.6 },
    60: { M: 123.6, F: 124.5 },
    61: { M: 123.5, F: 124.4 },
    62: { M: 123.3, F: 124.3 },
    63: { M: 123.0, F: 124.2 },
    64: { M: 122.8, F: 124.1 },
    65: { M: 122.5, F: 123.9 },
    66: { M: 122.2, F: 123.7 },
    67: { M: 121.8, F: 123.5 },
    68: { M: 121.4, F: 123.3 },
    69: { M: 120.9, F: 123.0 },
    70: { M: 120.4, F: 122.5 },
  },
  '7년납': {
    15: { M: 124.8, F: 124.8 },
    16: { M: 124.8, F: 124.8 },
    17: { M: 124.8, F: 124.8 },
    18: { M: 124.7, F: 124.8 },
    19: { M: 124.7, F: 124.8 },
    20: { M: 124.7, F: 124.8 },
    21: { M: 124.8, F: 124.8 },
    22: { M: 124.8, F: 124.8 },
    23: { M: 124.7, F: 124.8 },
    24: { M: 124.8, F: 124.8 },
    25: { M: 124.8, F: 124.8 },
    26: { M: 124.8, F: 124.8 },
    27: { M: 124.8, F: 124.8 },
    28: { M: 124.8, F: 124.8 },
    29: { M: 124.8, F: 124.9 },
    30: { M: 124.8, F: 124.9 },
    31: { M: 124.8, F: 124.8 },
    32: { M: 124.8, F: 124.8 },
    33: { M: 124.8, F: 124.9 },
    34: { M: 124.8, F: 124.9 },
    35: { M: 124.8, F: 124.9 },
    36: { M: 124.8, F: 124.8 },
    37: { M: 124.8, F: 124.9 },
    38: { M: 124.8, F: 124.9 },
    39: { M: 124.8, F: 124.8 },
    40: { M: 124.8, F: 124.9 },
    41: { M: 124.7, F: 124.8 },
    42: { M: 124.7, F: 124.8 },
    43: { M: 124.7, F: 124.8 },
    44: { M: 124.7, F: 124.8 },
    45: { M: 124.6, F: 124.8 },
    46: { M: 124.6, F: 124.8 },
    47: { M: 124.5, F: 124.7 },
    48: { M: 124.5, F: 124.7 },
    49: { M: 124.4, F: 124.7 },
    50: { M: 124.3, F: 124.7 },
    51: { M: 124.3, F: 124.7 },
    52: { M: 124.2, F: 124.7 },
    53: { M: 124.1, F: 124.6 },
    54: { M: 124.1, F: 124.6 },
    55: { M: 124.0, F: 124.6 },
    56: { M: 123.8, F: 124.6 },
    57: { M: 123.7, F: 124.5 },
    58: { M: 123.6, F: 124.4 },
    59: { M: 123.5, F: 124.4 },
    60: { M: 123.3, F: 124.3 },
    61: { M: 123.1, F: 124.1 },
    62: { M: 122.9, F: 124.1 },
    63: { M: 122.7, F: 123.9 },
    64: { M: 122.4, F: 123.7 },
    65: { M: 122.1, F: 123.6 },
    66: { M: 121.7, F: 123.3 },
    67: { M: 121.2, F: 123.1 },
    68: { M: 120.8, F: 122.8 },
    69: { M: 120.2, F: 122.3 },
    70: { M: 119.7, F: 121.7 },
  },
  '10년납': {
    15: { M: 120.8, F: 120.8 },
    16: { M: 120.9, F: 120.9 },
    17: { M: 120.8, F: 120.9 },
    18: { M: 120.8, F: 120.8 },
    19: { M: 120.8, F: 120.8 },
    20: { M: 120.8, F: 120.9 },
    21: { M: 120.8, F: 120.8 },
    22: { M: 120.8, F: 120.9 },
    23: { M: 120.8, F: 120.8 },
    24: { M: 120.8, F: 120.9 },
    25: { M: 120.8, F: 120.9 },
    26: { M: 120.8, F: 120.9 },
    27: { M: 120.8, F: 120.9 },
    28: { M: 120.8, F: 120.9 },
    29: { M: 120.8, F: 120.9 },
    30: { M: 120.9, F: 120.9 },
    31: { M: 120.8, F: 120.9 },
    32: { M: 120.8, F: 120.9 },
    33: { M: 120.9, F: 120.9 },
    34: { M: 120.8, F: 120.9 },
    35: { M: 120.8, F: 120.9 },
    36: { M: 120.8, F: 120.9 },
    37: { M: 120.8, F: 120.9 },
    38: { M: 120.8, F: 120.9 },
    39: { M: 120.8, F: 120.9 },
    40: { M: 120.8, F: 120.8 },
    41: { M: 120.8, F: 120.9 },
    42: { M: 120.7, F: 120.9 },
    43: { M: 120.7, F: 120.8 },
    44: { M: 120.6, F: 120.8 },
    45: { M: 120.6, F: 120.8 },
    46: { M: 120.5, F: 120.7 },
    47: { M: 120.5, F: 120.8 },
    48: { M: 120.4, F: 120.8 },
    49: { M: 120.3, F: 120.7 },
    50: { M: 120.2, F: 120.6 },
    51: { M: 120.2, F: 120.7 },
    52: { M: 120.1, F: 120.6 },
    53: { M: 120.0, F: 120.6 },
    54: { M: 119.8, F: 120.5 },
    55: { M: 119.8, F: 120.5 },
    56: { M: 119.6, F: 120.5 },
    57: { M: 119.5, F: 120.4 },
    58: { M: 119.3, F: 120.3 },
    59: { M: 119.1, F: 120.2 },
    60: { M: 118.9, F: 120.0 },
    61: { M: 118.7, F: 119.9 },
    62: { M: 118.3, F: 119.7 },
    63: { M: 118.1, F: 119.6 },
    64: { M: 117.7, F: 119.3 },
    65: { M: 117.3, F: 119.0 },
    66: { M: 116.7, F: 118.7 },
    67: { M: 116.1, F: 118.3 },
    68: { M: 115.6, F: 117.8 },
    69: { M: 114.9, F: 117.1 },
    70: { M: 114.1, F: 116.4 },
  },
};

/**
 * 환급률 조회 함수
 * @param period 납입기간 ('5년납' | '7년납' | '10년납')
 * @param age 보험연령
 * @param gender 성별 ('M' | 'F')
 * @returns 환급률 (예: 124.9) 또는 null (해당 데이터 없음)
 */
export function getRefundRate(
  period: PaymentPeriod,
  age: number,
  gender: Gender
): number | null {
  const periodData = REFUND_RATE_TABLE[period];
  if (!periodData) return null;
  
  const ageData = periodData[age];
  if (!ageData) return null;
  
  return ageData[gender] ?? null;
}

/**
 * 환급금 계산 함수
 * @param period 납입기간
 * @param age 보험연령
 * @param gender 성별
 * @param monthlyPremium 월 납입금액 (원)
 * @returns { rate: 환급률(%), interest: 이자(원), refund: 해약환급금(원) } 또는 null
 */
export function calculateRefund(
  period: PaymentPeriod,
  age: number,
  gender: Gender,
  monthlyPremium: number
): { rate: number; interest: number; refund: number; total: number } | null {
  const rate = getRefundRate(period, age, gender);
  if (rate === null) return null;
  
  const years = parseInt(period.replace(/[^0-9]/g, ''));
  const total = monthlyPremium * 12 * years;
  const rateDecimal = rate / 100;
  const refund = Math.round(total * rateDecimal);
  const interest = refund - total;
  
  return { rate, interest, refund, total };
}
